---
// Component for rendering interactive blocks in chapters
interface Props {
  block: {
    id: string;
    type: 'quiz' | 'simulation' | 'code-editor' | 'interactive-diagram';
    [key: string]: any;
  };
  userId?: number;
  progress?: {
    completed: boolean;
    score?: number;
    attempts: number;
  };
}

const { block, userId, progress } = Astro.props;
---

{block.type === 'quiz' && (
  <div class="interactive-block quiz-block" data-block-id={block.id} data-block-type="quiz">
    <div class="block-header">
      <div class="flex items-center gap-2 mb-2">
        <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
        </svg>
        <h3 class="text-lg font-semibold text-gray-900">Practice Quiz</h3>
        {progress?.completed && (
          <span class="text-sm text-green-600 font-medium">✓ Completed</span>
        )}
      </div>
    </div>
    <div class="block-content">
      <a
        href={`/quizzes/${block.quizId}`}
        class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
      >
        Start Quiz
        <svg class="ml-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </a>
      {progress && progress.attempts > 0 && (
        <div class="mt-3 text-sm text-gray-600">
          <span>Attempts: {progress.attempts}</span>
          {progress.score !== undefined && (
            <span class="ml-3">Best Score: {Math.round(progress.score)}%</span>
          )}
        </div>
      )}
    </div>
  </div>
)}

{block.type === 'simulation' && (
  <div class="interactive-block simulation-block" data-block-id={block.id} data-block-type="simulation">
    <div class="block-header">
      <div class="flex items-center gap-2 mb-2">
        <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <h3 class="text-lg font-semibold text-gray-900">Interactive Simulation</h3>
      </div>
    </div>
    <div class="block-content">
      {block.sourceUrl ? (
        <iframe
          src={block.sourceUrl}
          class="w-full h-96 border border-gray-200 rounded-lg"
          allow="fullscreen"
          loading="lazy"
        ></iframe>
      ) : block.embedCode ? (
        <div set:html={block.embedCode}></div>
      ) : (
        <div class="p-4 bg-gray-50 rounded-lg text-gray-500 text-center">
          Simulation configuration needed
        </div>
      )}
    </div>
  </div>
)}

{block.type === 'code-editor' && (
  <div class="interactive-block code-editor-block" data-block-id={block.id} data-block-type="code-editor">
    <div class="block-header">
      <div class="flex items-center gap-2 mb-2">
        <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
        </svg>
        <h3 class="text-lg font-semibold text-gray-900">Code Practice</h3>
      </div>
    </div>
    <div class="block-content">
      <div class="p-4 bg-gray-50 rounded-lg text-gray-500 text-center">
        Code editor coming soon
      </div>
    </div>
  </div>
)}

{block.type === 'interactive-diagram' && (
  <div class="interactive-block diagram-block" data-block-id={block.id} data-block-type="interactive-diagram">
    <div class="block-header">
      <div class="flex items-center gap-2 mb-2">
        <svg class="w-5 h-5 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2" />
        </svg>
        <h3 class="text-lg font-semibold text-gray-900">Interactive Diagram</h3>
        {progress?.completed && (
          <span class="text-sm text-cyan-600 font-medium">✓ Explored</span>
        )}
      </div>
    </div>
    <div class="block-content">
      <div class="p-4 bg-gray-50 rounded-lg text-gray-500 text-center">
        Interactive diagram coming soon
      </div>
    </div>
  </div>
)}

<style>
  .interactive-block {
    margin: 2rem 0;
    padding: 1.5rem;
    background: white;
    border: 2px solid #e5e7eb;
    border-radius: 0.75rem;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
  }

  .interactive-block .block-header {
    margin-bottom: 1rem;
  }

  .interactive-block .block-content {
    margin-top: 1rem;
  }

  .quiz-block {
    border-color: #10b981;
    background: #f0fdf4;
  }

  .simulation-block {
    border-color: #8b5cf6;
    background: #faf5ff;
  }

  .code-editor-block {
    border-color: #6366f1;
    background: #eef2ff;
  }

  .diagram-block {
    border-color: #06b6d4;
    background: #ecfeff;
  }
</style>

